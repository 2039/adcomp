<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>TMB Documentation: Multivariate distributions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TMB Documentation
   &#160;<span id="projectnumber">v1.6.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">Multivariate distributions</div>  </div>
</div><!--header-->
<div class="contents">

<p>Multivariate normal distributions, AR-processes, GMRF's, separable covariance functions, etc.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacedensity"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedensity.html">density</a></td></tr>
<tr class="memdesc:namespacedensity"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collection of multivariate Gaussian distributions (members listed in <a class="el" href="density_8hpp.html">density.hpp</a>) <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Multivariate normal distributions, AR-processes, GMRF's, separable covariance functions, etc. </p>
<p>The namespace </p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>density;</div>
</div><!-- fragment --><p> gives access to a variety of multivariate normal distributions:</p>
<ul>
<li>Multivariate normal distributions specified via a covariance matrix (structured or unstructured).</li>
<li>Autoregressive (AR) processes.</li>
<li>Gaussian Markov random fields (GMRF) defined on regular grids or defined via a (sparse) precision matrix.</li>
<li>Separable covariance functions, i.e. time-space separability.</li>
</ul>
<p>These seemingly unrelated concepts are all implemented via the notion of a <code>distribution</code>, which explains why they are placed in the same namespace. You can combine two <code>distributions</code>, and this lets you build up complex multivariate distributions using extremely compact notation. Due to the flexibility of the approach it is more abstract than other parts of TMB, but here it will be explained from scratch. Before looking at the different categories of multivariate distributions we note the following which is of practical importance:</p>
<ul>
<li>All members in the <code>density</code> namespace return the <b>negative</b> log density, opposed to the univariate densities in <a class="el" href="group__R__style__distribution.html">R style probability distributions</a>.</li>
</ul>
<h2>Multivariate normal distributions</h2>
<p>Consider a zero-mean multivariate normal distribution with covariance matrix <em>Sigma</em> (symmetric positive definite), that we want to evaluate at <em>x</em>: </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 10;</div>
<div class="line"><a class="code" href="structvector.html">vector&lt;Type&gt;</a> x(n);                     <span class="comment">// Evaluation point           </span></div>
<div class="line">x.fill(0.0);                           <span class="comment">// Point of evaluation: x = (0,0,...,0)</span></div>
</div><!-- fragment --><p>The negative log-normal density is evaluated as follows: </p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>density;</div>
<div class="line"><a class="code" href="structmatrix.html">matrix&lt;Type&gt;</a> Sigma(n,n);     <span class="comment">// Covariance matrix</span></div>
<div class="line"><span class="comment">// ..... User must assign value to Sigma here</span></div>
<div class="line">res = <a class="code" href="namespacedensity.html#a23773434ee2f7409f18752071fac2468">MVNORM</a>(Sigma)(x);      <span class="comment">// Evaluate negative log likelihod</span></div>
</div><!-- fragment --><p> In the last line <code>MVNORM(Sigma)</code> should be interpreted as a multivariate density, which via the last parenthesis <code></code>(x) is evaluated at <code>x</code>. A less compact way of expressing this is </p>
<div class="fragment"><div class="line"><a class="code" href="classMVNORM__t.html">MVNORM_t&lt;Type&gt;</a> your_dmnorm(Sigma);</div>
<div class="line">res = your_dmnorm(x);                </div>
</div><!-- fragment --><p> in which <code>your_dmnorm</code> is a variable that holds the "density".</p>
<p><em>Sigma</em> can be parameterized in different ways. Due to the symmetry of <em>Sigma</em> there are at most <em>n(n+1)/2</em> free parameters (<em>n</em> variances and <em>n(n-1)/2</em> correlation parameters). If you want to estimate all of these freely (modulo the positive definite constraint) you can use <a class="el" href="density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a> to specify the correlation matrix, and <a class="el" href="density_8hpp.html#aae30a0275dafde20092e4c12c6bda61e">VECSCALE</a> to specify variances. <a class="el" href="density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a> takes as input a vector a dummy parameters that internally is used to build the correlation matrix via its cholesky factor. </p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>density;</div>
<div class="line"><span class="keywordtype">int</span> n = 10;</div>
<div class="line"><a class="code" href="structvector.html">vector&lt;Type&gt;</a> unconstrained_params(n*(n-1)/2);  <span class="comment">// Dummy parameterization of correlation matrix         </span></div>
<div class="line"><a class="code" href="structvector.html">vector&lt;Type&gt;</a> sds(n);                   <span class="comment">// Standard deviations</span></div>
<div class="line">res = <a class="code" href="namespacedensity.html#ad4883b13b683e6b9e1e27846b74e4680">VECSCALE</a>(<a class="code" href="namespacedensity.html#aec3874ac89bc3a5d5d4d245db46b09e4">UNSTRUCTURED_CORR</a>(unconstrained_params),sds)(x);</div>
</div><!-- fragment --><p> If all elements of <code>dummy_params</code> are estimated we are in effect estimating a full correlation matrix without any constraints on its elements (except for the mandatory positive definiteness). The actual value of the correlation matrix, but not the full covariance matrix, can easily be assessed using the <code>".cov()"</code> operator </p>
<div class="fragment"><div class="line"><a class="code" href="structmatrix.html">matrix&lt;Type&gt;</a> Sigma(n,n);      </div>
<div class="line">Sigma = <a class="code" href="density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a>(unconstrained_params).cov();</div>
<div class="line"><a class="code" href="tmb__core_8hpp.html#ac2d7888f4e0385930448f992de53079b">REPORT</a>(Sigma);                                         <span class="comment">// Report back to R session</span></div>
</div><!-- fragment --><h2>Autoregressive processes</h2>
<p>Consider a stationary univariate Gaussian AR1 process <em>x(t), t=0,...,n-1</em>. The stationary distribution is choosen so that:</p>
<ul>
<li><em>x(t)</em> has mean 0 and variance 1 (for all <em>t</em>).</li>
</ul>
<p>The multivariate density of the vector <em>x</em> can be evaluated as follows </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 10;</div>
<div class="line"><span class="keyword">using namespace </span>density;</div>
<div class="line"></div>
<div class="line"><a class="code" href="structvector.html">vector&lt;Type&gt;</a> x(n);           <span class="comment">// Evaluation point           </span></div>
<div class="line">x.fill(0.0);                    <span class="comment">// Point of evaluation: x = (0,0,...,0)</span></div>
<div class="line">Type rho = 0.2;              <span class="comment">// Correlation parameter</span></div>
<div class="line">res = <a class="code" href="namespacedensity.html#a74cd095b6502e658b9e9f0c58da1c60d">AR1</a>(rho)(x);           <span class="comment">// Evaluate negative log-density of AR1 process at point x </span></div>
</div><!-- fragment --><p>Due to the assumed stationarity the correlation parameter must satisfy:</p>
<ul>
<li><b>Stationarity</b> constraint: -1 &lt; <em>rho</em> &lt; 1</li>
</ul>
<p>Note that <em>cor[x(t),x(t-1)] = rho</em>.</p>
<p>The <code>SCALE</code> function can be used to set the standard deviation. </p>
<div class="fragment"><div class="line">Type sigma = 2.1;            <span class="comment">// standard deviation of x</span></div>
<div class="line">res = <a class="code" href="density_8hpp.html#adb89a5b22d8790cef917f8eec210bfc6">SCALE</a>(<a class="code" href="density_8hpp.html#a65620999261cc95feb42ebc39b406d72">AR1</a>(rho),sigma)(x);  </div>
</div><!-- fragment --><p> Now, <em>var[x(t)] = sigma^2</em>. Because all elements of <code>x</code> are scaled by the same constant we use SCALE rather than VECSCALE.</p>
<h4>Multivariate AR1 processes</h4>
<p>This is the first real illustrations of how distributions can be used as building blocks to obtain more complex distributions. Consider the <em>p</em> dimensional AR1 process </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = 10;                   <span class="comment">// Number of time steps</span></div>
<div class="line"><span class="keywordtype">int</span> p=3;                      <span class="comment">// dim(x)</span></div>
<div class="line"><a class="code" href="structarray.html">array&lt;Type&gt;</a> x(p,n);           <span class="comment">// Evaluation point       </span></div>
</div><!-- fragment --><p> The columns in <code>x</code> refer to the different time points. We then evaluate the (negative log) joint density of the time series. </p>
<div class="fragment"><div class="line"><a class="code" href="classMVNORM__t.html">MVNORM_t&lt;Type&gt;</a> your_dmnorm(Sigma);  <span class="comment">// Density of x(t) </span></div>
<div class="line">Type phi;                           <span class="comment">// Correlation parameter</span></div>
<div class="line">res = <a class="code" href="density_8hpp.html#a65620999261cc95feb42ebc39b406d72">AR1</a>(phi,your_dmnorm)(x);</div>
</div><!-- fragment --><p> Note the following:</p>
<ul>
<li>We have introduced an intermediate variable <code>your_dmnorm</code>, which holds the p-dim density marginal density of <em>x(t)</em>. This is a zero-mean normal density with covariance matrix <code>Sigma</code>.</li>
<li>All <em>p</em> univarite time series have the same serial correlation .</li>
<li>The multivariate process <em>x(t)</em> is stationary in the same sense as the univariate AR1 process described above.</li>
</ul>
<h4>Higher order AR processes</h4>
<p>There also exists <a class="el" href="classARk__t.html">ARk_t</a> of arbitrary autoregressive order.</p>
<h2>Gaussian Markov random fields (GMRF)</h2>
<p>GMRF may be defined in two ways:</p>
<ol type="1">
<li>Via a (sparse) precision matrix Q</li>
<li>Via a d-dimensional lattice</li>
</ol>
<p>For further details please see <a class="el" href="classGMRF__t.html">GMRF_t</a>. Under 1) a sparse Q corresponding to a Matern covariance function can be obtained via the <a class="el" href="namespaceR__inla.html">R_inla</a> namespace.</p>
<h2>Separable construction of covariance (precision) matrices</h2>
<p>A typical use of separability is to create space-time models with a sparse precision matrix. Details are given in <a class="el" href="classSEPARABLE__t.html">SEPARABLE_t</a>. Here we give a simple example.</p>
<p>Assume that we study a quantity <code>x</code> that changes both in space and time. For simplicity we consider only a one-dimensional space. We discretize space and time using equidistant grids, and assume that the distance between grid points is 1 in both dimensions. We then define an AR1(rho_s) process in space and one in time AR1(rho_t). The separable assumption is that two points <code>x1</code> and <code>x2</code>, separated in space by a distance <code>ds</code> and in time by a distance <code>dt</code>, have correlation given by</p>
<p><code>rho_s^ds*rho_t^dt</code> </p>
<p>This is implemented as </p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>density;</div>
<div class="line"><span class="keywordtype">int</span> n_s = 10;                   <span class="comment">// Number of grid points in space</span></div>
<div class="line"><span class="keywordtype">int</span> n_t = 10;                   <span class="comment">// Number of grid points in time</span></div>
<div class="line">Type rho_s = 0.2;               <span class="comment">// Correlation in space</span></div>
<div class="line">Type rho_t = 0.4;               <span class="comment">// Correlation in time</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="structarray.html">array&lt;Type&gt;</a> x(n_s,n_t);         </div>
<div class="line">x.setZero();                    <span class="comment">// x = 0</span></div>
<div class="line"></div>
<div class="line">res = <a class="code" href="namespacedensity.html#a7163798c4b0467ac2e570b034d7ca4c5">SEPARABLE</a>(<a class="code" href="namespacedensity.html#a74cd095b6502e658b9e9f0c58da1c60d">AR1</a>(rho_t),<a class="code" href="namespacedensity.html#a74cd095b6502e658b9e9f0c58da1c60d">AR1</a>(rho_s))(x);</div>
</div><!-- fragment --><p>Note that the arguments to <code><a class="el" href="density_8hpp.html#afd76474bb73fa9af11b9dfb6c11f0c57">SEPARABLE()</a></code> are given in the opposite order to the dimensions of <code>x</code>. </p>
</div><!-- contents -->
License: <a href="https://gnu.org/licenses/old-licenses/gpl-2.0.txt">GPL v2</a>
