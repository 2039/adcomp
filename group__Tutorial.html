<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>TMB Documentation: Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TMB Documentation
   &#160;<span id="projectnumber">v1.6.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Getting started</div>  </div>
</div><!--header-->
<div class="contents">

<p>A general introduction to TMB.  
<a href="#details">More...</a></p>
<p>A general introduction to TMB. </p>
<p>A TMB project consists of an R file (*.R) and a C++ file (*.cpp). The R file does pre- and post processing of data in addition to maximizing the log-likelihood contained in *.cpp. See <a class="el" href="group__Examples.html">Example collection</a> for more details. All R functions are documented within the standard help system in R. This tutorial describes how to write the C++ file, and assumes familiarity with C++ and to some extent with R.</p>
<p>The purpose of the C++ program is to evaluate the objective function, i.e. the negative log-likelihood of the model. The program is compiled and called from R, where it can be fed to a function minimizer like <code>nlminb()</code>.</p>
<p>The objective function should be of the following C++ type: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="TMB_8hpp.html">TMB.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Type&gt;</div>
<div class="line">Type <a class="code" href="classobjective__function.html#a789a65f93df89fa5bc1d992cd56d5c87">objective_function&lt;Type&gt;::operator() </a>()</div>
<div class="line">{</div>
<div class="line">.... Here goes your <a class="code" href="splines_8hpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>++ code ..... </div>
<div class="line">}</div>
</div><!-- fragment --><p> The first line includes the source code for the whole TMB package (and all its dependencies). The objective function is a templated class where <code>&lt;Type&gt;</code> is the data type of both the input values and the return value of the objective function. This allows us to evaluate both the objective function and its derivatives using the same chunk of C++ code (via the AD package <a href="http://www.coin-or.org/CppAD/Doc/doxydoc/html/index.html">CppAD</a>). The technical aspects of this are hidden from the user. There is however one aspect that surprises the new TMB user. When a constant like "1.2" is used in a calculation that affects the return value it must be "cast" to Type: </p>
<div class="fragment"><div class="line">Type nll;            <span class="comment">// Define variable that holds the return value (neg. log. lik)</span></div>
<div class="line">nll = Type(1.2);     <span class="comment">// Assign value 1.2; a cast is needed.</span></div>
</div><!-- fragment --><h2>Obtaining data and parameter values from R</h2>
<p>Obviously, we will need to pass both data and parameter values to the objective function. This is done through a set of macros that TMB defines for us. To see which macros are available start typing <code>DATA_</code> or <code>PARAMETER_</code> in the Doxygen search field of your browser (you may need to refresh the browser window between each time you make a new search). A simple example if you want to read a vector of numbers (doubles) is the following </p>
<div class="fragment"><div class="line"><a class="code" href="tmb__core_8hpp.html#ad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>(x);               <span class="comment">// Vector x(0),x(1),...,x(n-1), where n is the length of x</span></div>
</div><!-- fragment --><p> Note that all vectors and matrices in TMB uses a <b>zero-based</b> indexing scheme. It is not necessary to explicitly pass the dimension of <code>x</code>, as it can be retrieved inside the C++ program: </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = x.size(); </div>
</div><!-- fragment --><h2>An extended C++ language</h2>
<p>TMB extends C++ with functionality that is important for formulating likelihood functions. You have different toolboxes available:</p>
<ul>
<li>Standard C++ used for infrastructure like loops etc.</li>
<li>Vector, matrix and array library (see <a class="el" href="group__matrix__arrays.html">Matrices and arrays</a>)</li>
<li>Probability distributions (see <a class="el" href="group__Densities.html">Multivariate distributions</a> and <a class="el" href="group__R__style__distribution.html">R style probability distributions</a>)</li>
</ul>
<p>In addition to the variables defined through the <code>DATA_</code> or <code>PARAMETER_</code> macros there can be "local" variables, for which ordinary C++ scoping rules apply. There must also be a variable that holds the return value (neg. log. likelihood). </p>
<div class="fragment"><div class="line"><a class="code" href="tmb__core_8hpp.html#ad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>(x);               <span class="comment">// Vector x(0),x(1),...,x(n-1)</span></div>
<div class="line">Type tmp = x(1);</div>
<div class="line">Type nll=tmp*tmp; </div>
</div><!-- fragment --><p> As in ordinary C++ local variable tmp must be assigned a value before it can enter into a calculation.</p>
<h2>Statistical modelling</h2>
<p>TMB can handle complex statistical problems with hierarchical structure (latent random variables) and multiple data sources. Latent random variables must be continuous (discrete distributions are not handled). The <code>PARAMETER_</code> macros are used to pass two types of parameters.</p>
<ul>
<li><b>Parameters:</b> to be estimated by maximum likelihood. These include fixed effects and variance components in the mixed model literature. They will also correspond to hyper parameters with non-informative priors in the Bayesian literature.</li>
<li><b>Latent</b> <b>random</b> <b>variables:</b> to be integrated out of the likelihood using a Laplace approximation.</li>
</ul>
<p>Which of these are chosen is controlled from R, via the <code>random</code> argument to the function <code>MakeADFun</code>. However, on the C++ side it is usually necessary to assign a probability distribution to the parameter.</p>
<p>The purpose of the C++ program is to calculate the (negative) joint density of data and latent random variables. Each datum and individual latent random effect gives a contribution to log likelihood, which may be though of as a "distribution assignment" by users familiar with software in the BUGS family. </p>
<div class="fragment"><div class="line"><a class="code" href="tmb__core_8hpp.html#a6b8a70eeee38fe896e89e0a9c6bef84a">PARAMETER_VECTOR</a>(u);          <span class="comment">// Latent random variable </span></div>
<div class="line">Type nll = Type(0);           <span class="comment">// Return value</span></div>
<div class="line">nll -= <a class="code" href="dnorm_8hpp.html#a5eb914782c488bd3ec4a50d4e4a73394">dnorm</a>(u(0),0,1,<span class="keyword">true</span>)   <span class="comment">// Distributional assignment: u(0) ~ N(0,1) </span></div>
</div><!-- fragment --><p> The following rules apply:</p>
<ul>
<li>Distribution assignments do not need to take place before the latent variable is used in a calculation.</li>
<li>More complicated distributional assignments are allowed, say u(0)-u(1) ~ N(0,1), but this requires the user to have a deeper understanding of the probabilistic aspects of the model.</li>
<li>For latent variables only normal distributions should be used (otherwise the Laplace approximation will perform poorly). For response variables all probability distributions (discrete or continuous) are allowed. If a non-gaussian latent is needed the "transformation trick" can be used.</li>
<li>The namespaces <a class="el" href="group__R__style__distribution.html">R style probability distributions</a> and <a class="el" href="group__Densities.html">Multivariate distributions</a> contain many probability distributions, including multivariate normal distributions. For probability distributions not available from these libraries, the user can use raw C++ code: <div class="fragment"><div class="line"><a class="code" href="tmb__core_8hpp.html#ad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>(y);               <span class="comment">// Data vector</span></div>
<div class="line">Type nll = Type(0);           <span class="comment">// Return value</span></div>
<div class="line">nll -= <a class="code" href="convenience_8hpp.html#a1fe3cb777e8fd8080385579ab87600e3">sum</a>(-log(Type(1.0)+y*y));      <span class="comment">// y are i.i.d. Cauchy distributed</span></div>
</div><!-- fragment --></li>
</ul>
<p>See <a class="el" href="group__Toolbox.html">Statistical toolbox</a> for more about statistical modelling. </p>
</div><!-- contents -->
License: <a href="https://gnu.org/licenses/old-licenses/gpl-2.0.txt">GPL v2</a>
